

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Клиент жишээ кодууд &mdash; Төрийн мэдээлэл солилцооны систем 1.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Бусад" href="faq.html" />
    <link rel="prev" title="5. Вэб сервис дуудах" href="../docs/doc4.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Танилцуулга</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/info.html">Танилцуулга</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/services.html">Веб сервисийн жагсаалт</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Холбогдох заавар</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../docs/connection.html">1. Холбогдох заавар</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/doc1.html">2. Системд холбогдох</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/doc2.html">3. Гэрчилгээ нэмэх</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/doc3.html">4. Тохиргоо шалгах</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/doc4.html">5. Веб сервис дуудах</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Бусад</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Клиент жишээ кодууд</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Түгээмэл асуулт, хариулт(FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="others.html">Холбоо барих</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Төрийн мэдээлэл солилцооны систем</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Клиент жишээ кодууд</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/others/example_codes.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-codes1">
<span id="id1"></span><h1>Клиент жишээ кодууд<a class="headerlink" href="#example-codes1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="python">
<h2>1. Python хэл дээрх хэрэгжүүлэлт<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="line-block">
<div class="line">1.1 Шаардлагатай “package”-уудыг суулгах</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ cat requirements.txt
<span class="nv">appdirs</span><span class="o">==</span><span class="m">1</span>.4.3
cached-property<span class="o">==</span><span class="m">1</span>.3.1
<span class="nv">certifi</span><span class="o">==</span><span class="m">2017</span>.7.27.1
<span class="nv">chardet</span><span class="o">==</span><span class="m">3</span>.0.4
<span class="nv">defusedxml</span><span class="o">==</span><span class="m">0</span>.5.0
<span class="nv">idna</span><span class="o">==</span><span class="m">2</span>.6
<span class="nv">isodate</span><span class="o">==</span><span class="m">0</span>.6.0
<span class="nv">lxml</span><span class="o">==</span><span class="m">4</span>.1.1
<span class="nv">pytz</span><span class="o">==</span><span class="m">2017</span>.3
<span class="nv">requests</span><span class="o">==</span><span class="m">2</span>.18.4
requests-toolbelt<span class="o">==</span><span class="m">0</span>.8.0
<span class="nv">six</span><span class="o">==</span><span class="m">1</span>.11.0
<span class="nv">urllib3</span><span class="o">==</span><span class="m">1</span>.22
<span class="nv">zeep</span><span class="o">==</span><span class="m">2</span>.4.0
<span class="nv">pycrypto</span><span class="o">==</span><span class="m">2</span>.6.1

$ pip install -r requirements.txt
</pre></div>
</div>
<div class="line-block">
<div class="line">1.2 Тоон гарын үсэг зурах модуль “XypSign.py”</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>
<span class="kn">from</span> <span class="nn">Crypto.Hash</span> <span class="kn">import</span> <span class="n">SHA256</span>
<span class="kn">from</span> <span class="nn">Crypto.Signature</span> <span class="kn">import</span> <span class="n">PKCS1_v1_5</span>
<span class="kn">from</span> <span class="nn">Crypto.PublicKey</span> <span class="kn">import</span> <span class="n">RSA</span>

<span class="k">class</span> <span class="nc">XypSign</span><span class="p">:</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">KeyPath</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">KeyPath</span> <span class="o">=</span> <span class="n">KeyPath</span>

<span class="k">def</span> <span class="nf">__GetPrivKey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">KeyPath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">keyfile</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="n">keyfile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">def</span> <span class="nf">__toBeSigned</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accessToken</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
    <span class="s1">&#39;accessToken&#39;</span> <span class="p">:</span> <span class="n">accessToken</span><span class="p">,</span>
    <span class="s1">&#39;timeStamp&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__timestamp</span><span class="p">(),</span>
    <span class="p">}</span>

<span class="k">def</span> <span class="nf">__buildParam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toBeSigned</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">toBeSigned</span><span class="p">[</span><span class="s1">&#39;accessToken&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">toBeSigned</span><span class="p">[</span><span class="s1">&#39;timeStamp&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accessToken</span><span class="p">):</span>
    <span class="n">toBeSigned</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__toBeSigned</span><span class="p">(</span><span class="n">accessToken</span><span class="p">)</span>
    <span class="n">digest</span> <span class="o">=</span> <span class="n">SHA256</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
    <span class="n">digest</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buildParam</span><span class="p">(</span><span class="n">toBeSigned</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">pkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetPrivKey</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">toBeSigned</span><span class="p">,</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">PKCS1_v1_5</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">pkey</span><span class="p">)</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">digest</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">__timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">XypSign</span><span class="p">(</span><span class="s1">&#39;prvate_key.key&#39;</span><span class="p">)</span>
<span class="n">toBeSigned</span><span class="p">,</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="s1">&#39;access_token&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="n">toBeSigned</span>
<span class="nb">print</span> <span class="n">signature</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">1.3 ХУР Төрийн Мэдээлэл Солилцооны системээс сервис дуудах жишээ код “XypClient.py”</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">zeep</span><span class="o">,</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">XypSign</span> <span class="kn">import</span> <span class="n">XypSign</span>
<span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">Session</span>

<span class="k">class</span> <span class="nc">Service</span><span class="p">():</span>

<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wsdl</span><span class="p">,</span> <span class="n">pkey_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    param: wsdl - wsdl зам</span>
<span class="sd">    param: pkey_path - VPN сүлжээнд холбогдоход өгсөн хувийн түлхүүрийн файлын зам.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__accessToken</span> <span class="o">=</span> <span class="s1">&#39;access_token&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">__toBeSigned</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__signature</span> <span class="o">=</span> <span class="n">XypSign</span><span class="p">(</span><span class="n">pkey_path</span><span class="p">)</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__accessToken</span><span class="p">)</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">transport</span> <span class="o">=</span> <span class="n">zeep</span><span class="o">.</span><span class="n">Transport</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">zeep</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">wsdl</span><span class="p">,</span> <span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;accessToken&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__accessToken</span><span class="p">,</span>
    <span class="s1">&#39;timeStamp&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__toBeSigned</span><span class="p">[</span><span class="s1">&#39;timeStamp&#39;</span><span class="p">],</span>
    <span class="s1">&#39;signature&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__signature</span>
    <span class="p">})</span>

<span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operation</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">service</span><span class="p">[</span><span class="n">operation</span><span class="p">](</span><span class="n">params</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">ex</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">operation</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>

<span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;citizen&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;regnum&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>           <span class="c1"># Иргэний регистрийн дугаар</span>
    <span class="s1">&#39;fingerprint&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>       <span class="c1"># Иргэний хурууны хээний зураг. 310x310 харьцаатай PNG өртгөлтэй</span>
    <span class="p">},</span>
    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;regnum&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>           <span class="c1"># Үйлчилгээг үзүүлэгч ажилтны регистрийн дугаар</span>
    <span class="s1">&#39;fingerprint&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>       <span class="c1"># Үйлчилгээг үзүүлэгч ажилтны хурууны хээний зураг. 310x310 харьцаатай PNG өртгөлтэй</span>
    <span class="p">}</span>
<span class="p">},</span>
<span class="s1">&#39;regnum&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span>               <span class="c1"># Иргэний регистрийн дугаар</span>
<span class="p">}</span>

<span class="n">citizen</span> <span class="o">=</span> <span class="n">Service</span><span class="p">(</span><span class="s1">&#39;https://xyp.gov.mn/citizen-1.2.1/ws?WSDL&#39;</span><span class="p">,</span> <span class="n">pkey_path</span><span class="o">=</span><span class="s1">&#39;private_key.key&#39;</span><span class="p">)</span>
<span class="n">citizen</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;WS100101_getCitizenIDCardInfo&#39;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="php">
<h2>2. PHP хэл дээрх хэрэгжүүлэлт<a class="headerlink" href="#php" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="line-block">
<div class="line">2.1 Тоон гарын үсэг зурах модуль “XypSign.php”</div>
</div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">class XypSign{</span>

<span class="x">private $KeyPath;</span>
<span class="x">private $accessToken;</span>

<span class="x">function __construct($KeyPath, $accessToken){</span>
<span class="x">    $this-&gt;KeyPath = $KeyPath;</span>
<span class="x">    $this-&gt;accessToken = $accessToken;</span>
<span class="x">}</span>

<span class="x">public function sign(){</span>
<span class="x">    $pkey = file_get_contents($this-&gt;KeyPath);</span>
<span class="x">    $timestamp = time();</span>
<span class="x">    openssl_sign($this-&gt;accessToken . &quot;.&quot; . $timestamp, $signature, $pkey, OPENSSL_ALGO_SHA256);</span>
<span class="x">    return [</span>
<span class="x">    &#39;accessToken&#39; =&gt; $this-&gt;accessToken,</span>
<span class="x">    &#39;timeStamp&#39; =&gt; $timestamp,</span>
<span class="x">    &#39;signature&#39; =&gt; base64_encode($signature),</span>
<span class="x">    ];</span>
<span class="x">}</span>

<span class="x">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">2.2 ХУР Төрийн Мэдээлэл Солилцооны системээс сервис дуудах жишээ код “XypClient.php”</div>
</div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">require_once(&#39;XypSign.php&#39;);</span>

<span class="x">$keyPath = &#39;private_key.key&#39;;                       // VPN сүлжээнд холбогдоход өгсөн хувийн түлхүүрийн файлын зам.</span>
<span class="x">$accessToken = &quot;access_token&quot;;                      // Хандалтын токен</span>

<span class="x">$sign = new XypSign($keyPath, $accessToken);</span>
<span class="x">$signingInfo = $sign-&gt;sign();</span>

<span class="x">try{</span>
<span class="x">$client = new SoapClient(</span>
<span class="x">    &quot;https://xyp.gov.mn/citizen-1.2.1/ws?WSDL&quot;,</span>
<span class="x">    [</span>
<span class="x">    &#39;soapVersion&#39; =&gt; SOAP_1_2,</span>
<span class="x">    &#39;stream_context&#39; =&gt; stream_context_create([</span>
<span class="x">        &#39;ssl&#39; =&gt; [</span>
<span class="x">        &#39;verify_peer&#39; =&gt; false,</span>
<span class="x">        &#39;allow_self_signed&#39; =&gt; true</span>
<span class="x">        ],</span>
<span class="x">        &#39;http&#39; =&gt; [</span>
<span class="x">        &#39;header&#39; =&gt; &quot;accessToken: $signingInfo[accessToken]\r\n&quot;.</span>
<span class="x">        &quot;timeStamp: $signingInfo[timeStamp]\r\n&quot;.</span>
<span class="x">        &quot;signature: $signingInfo[signature]&quot;</span>
<span class="x">        ]</span>
<span class="x">    ])</span>
<span class="x">    ]</span>
<span class="x">);</span>

<span class="x">$soapParam = [</span>
<span class="x">    &quot;auth&quot; =&gt; [</span>
<span class="x">    &quot;citizen&quot; =&gt; [</span>
<span class="x">        &quot;fingerprint&quot; =&gt; &quot;&quot;,       // Иргэний хурууны хээний зураг. 310x310 харьцаатай PNG өртгөлтэй</span>
<span class="x">        &quot;regnum&quot; =&gt; &quot;&quot;             // Иргэний регистрийн дугаар</span>
<span class="x">    ],</span>
<span class="x">    &quot;operator&quot; =&gt; [</span>
<span class="x">        &quot;regnum&quot; =&gt; &quot;&quot;,            // Үйлчилгээг үзүүлэгч ажилтны регистрийн дугаар</span>
<span class="x">        &quot;fingerprint&quot; =&gt; &quot;&quot;        // Үйлчилгээг үзүүлэгч ажилтны хурууны хээний зураг. 310x310 харьцаатай PNG өртгөлтэй</span>
<span class="x">    ],</span>
<span class="x">    ],</span>
<span class="x">    &quot;regnum&quot; =&gt; &quot;&quot;                 // Иргэний регистрийн дугаар</span>
<span class="x">];</span>

<span class="x">$result = $client-&gt;WS100101_getCitizenIDCardInfo([&#39;request&#39; =&gt; $soapParam]);</span>
<span class="x">var_dump($result);</span>

<span class="x">}catch (\Exception $ex) {</span>
<span class="x">$result = &quot;ХУР -тай холбогдох үд гарсан алдаа: &quot; . $ex-&gt;getMessage();</span>
<span class="x">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="java">
<h2>3. JAVA хэл дээрх хэрэгжүүлэлт<a class="headerlink" href="#java" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="line-block">
<div class="line">3.1 JKS файл үүсгэх Эхлээд VPN сүлжээнд холбогдоход өгөгдсөн тоон гэрчилгээ болон хувийн түлхүүрийг pkcs12 форматтай болгох ёстой.</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ openssl pkcs12 -export -in &lt;certificate_file&gt; -inkey <span class="s2">&quot;private_key_file&quot;</span> -name <span class="s2">&quot;xyp&quot;</span> -out &lt;output_file.p12&gt;
Enter Export Password:
Verifying - Enter Export Password:

pkcs12 формат нь тоон гэрчилгээ хувийн түлхүүрийг нууц үгээр хамгаалдаг тул нууц үгийг заавал оруулж өгнө.
</pre></div>
</div>
<div class="line-block">
<div class="line">Java keytool ашиглан “JKS” файл үүсгэх.</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ keytool -importkeystore -deststorepass <span class="s1">&#39;KEY_STORE_PASS&#39;</span> -destkeystore &lt;jks_file_name.jks&gt; -srckeystore &lt;pkcs12_file.p12&gt; -srcstoretype PKCS12
Importing keystore &lt;pkcs12_file.p12&gt; to &lt;jks_file_name.jks&gt;...
Enter <span class="nb">source</span> keystore password:
Entry <span class="k">for</span> <span class="nb">alias</span> xyp successfully imported.
Import <span class="nb">command</span> completed:  <span class="m">1</span> entries successfully imported, <span class="m">0</span> entries failed or cancelled

KEY_STORE_PASS нь .p12 файлын нууц үгтэй ижилхэн байх ёстойг анхаарна уу... Ижилхэн биш бол JAVA - <span class="s2">&quot;Cannot recover key&quot;</span> Exception өгдөг.
</pre></div>
</div>
<div class="line-block">
<div class="line">3.2 xyp.gov.mn сайтын тоон гэрчилгээг JAVA итгэмжлэгдсэн гэрчилгээн санд нэмэх. Доорх InstallCert.java кодыг зааврын дагуу ажиллуулах.</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Copyright 2006 Sun Microsystems, Inc.  All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions</span>
<span class="cm"> * are met:</span>
<span class="cm"> *</span>
<span class="cm"> *   - Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *   - Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in the</span>
<span class="cm"> *     documentation and/or other materials provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> *   - Neither the name of Sun Microsystems nor the names of its</span>
<span class="cm"> *     contributors may be used to endorse or promote products derived</span>
<span class="cm"> *     from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span>
<span class="cm"> * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span>
<span class="cm"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<span class="cm"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
<span class="cm"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<span class="cm"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="cm"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<span class="cm"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="cm"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="cm"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="cm"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> */</span>
<span class="cm">/**</span>
<span class="cm"> * Originally from:</span>
<span class="cm"> * http://blogs.sun.com/andreas/resource/InstallCert.java</span>
<span class="cm"> * Use:</span>
<span class="cm"> * java InstallCert hostname</span>
<span class="cm"> * Example:</span>
<span class="cm"> *% java InstallCert ecc.fedora.redhat.com</span>
<span class="cm"> */</span>

<span class="kn">import</span> <span class="nn">javax.net.ssl.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.KeyStore</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.cert.CertificateException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.cert.X509Certificate</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">InstallCert</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">host</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">passphrase</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">String</span><span class="o">[]</span> <span class="n">c</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">.</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;:&quot;</span><span class="p">);</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">c</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
            <span class="n">port</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mi">443</span> <span class="p">:</span> <span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">c</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="na">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;changeit&quot;</span> <span class="p">:</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
            <span class="n">passphrase</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Usage: java InstallCert &lt;host&gt;[:port] [passphrase]&quot;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="s">&quot;jssecacerts&quot;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">isFile</span><span class="p">()</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">char</span> <span class="n">SEP</span> <span class="o">=</span> <span class="n">File</span><span class="p">.</span><span class="na">separatorChar</span><span class="p">;</span>
            <span class="n">File</span> <span class="n">dir</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;java.home&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">SEP</span>
                    <span class="o">+</span> <span class="s">&quot;lib&quot;</span> <span class="o">+</span> <span class="n">SEP</span> <span class="o">+</span> <span class="s">&quot;security&quot;</span><span class="p">);</span>
            <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="s">&quot;jssecacerts&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="na">isFile</span><span class="p">()</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="s">&quot;cacerts&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Loading KeyStore &quot;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span><span class="p">);</span>
        <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
        <span class="n">KeyStore</span> <span class="n">ks</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">KeyStore</span><span class="p">.</span><span class="na">getDefaultType</span><span class="p">());</span>
        <span class="n">ks</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">in</span><span class="p">,</span> <span class="n">passphrase</span><span class="p">);</span>
        <span class="n">in</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>

        <span class="n">SSLContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">SSLContext</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;TLS&quot;</span><span class="p">);</span>
        <span class="n">TrustManagerFactory</span> <span class="n">tmf</span> <span class="o">=</span>
                <span class="n">TrustManagerFactory</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">TrustManagerFactory</span><span class="p">.</span><span class="na">getDefaultAlgorithm</span><span class="p">());</span>
        <span class="n">tmf</span><span class="p">.</span><span class="na">init</span><span class="p">(</span><span class="n">ks</span><span class="p">);</span>
        <span class="n">X509TrustManager</span> <span class="n">defaultTrustManager</span> <span class="o">=</span> <span class="p">(</span><span class="n">X509TrustManager</span><span class="p">)</span> <span class="n">tmf</span><span class="p">.</span><span class="na">getTrustManagers</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="n">SavingTrustManager</span> <span class="n">tm</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SavingTrustManager</span><span class="p">(</span><span class="n">defaultTrustManager</span><span class="p">);</span>
        <span class="n">context</span><span class="p">.</span><span class="na">init</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">new</span> <span class="n">TrustManager</span><span class="o">[]</span><span class="p">{</span><span class="n">tm</span><span class="p">},</span> <span class="kc">null</span><span class="p">);</span>
        <span class="n">SSLSocketFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="na">getSocketFactory</span><span class="p">();</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Opening connection to &quot;</span> <span class="o">+</span> <span class="n">host</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span><span class="p">);</span>
        <span class="n">SSLSocket</span> <span class="n">socket</span> <span class="o">=</span> <span class="p">(</span><span class="n">SSLSocket</span><span class="p">)</span> <span class="n">factory</span><span class="p">.</span><span class="na">createSocket</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
        <span class="n">socket</span><span class="p">.</span><span class="na">setSoTimeout</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Starting SSL handshake...&quot;</span><span class="p">);</span>
            <span class="n">socket</span><span class="p">.</span><span class="na">startHandshake</span><span class="p">();</span>
            <span class="n">socket</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;No errors, certificate is already trusted&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">SSLException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span> <span class="o">=</span> <span class="n">tm</span><span class="p">.</span><span class="na">chain</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">chain</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Could not obtain server certificate chain&quot;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span>
                <span class="k">new</span> <span class="n">BufferedReader</span><span class="p">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">in</span><span class="p">));</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Server sent &quot;</span> <span class="o">+</span> <span class="n">chain</span><span class="p">.</span><span class="na">length</span> <span class="o">+</span> <span class="s">&quot; certificate(s):&quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
        <span class="n">MessageDigest</span> <span class="n">sha1</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;SHA1&quot;</span><span class="p">);</span>
        <span class="n">MessageDigest</span> <span class="n">md5</span> <span class="o">=</span> <span class="n">MessageDigest</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;MD5&quot;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">chain</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">X509Certificate</span> <span class="n">cert</span> <span class="o">=</span> <span class="n">chain</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span>
                    <span class="p">(</span><span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; Subject &quot;</span> <span class="o">+</span> <span class="n">cert</span><span class="p">.</span><span class="na">getSubjectDN</span><span class="p">());</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;   Issuer  &quot;</span> <span class="o">+</span> <span class="n">cert</span><span class="p">.</span><span class="na">getIssuerDN</span><span class="p">());</span>
            <span class="n">sha1</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">cert</span><span class="p">.</span><span class="na">getEncoded</span><span class="p">());</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;   sha1    &quot;</span> <span class="o">+</span> <span class="n">toHexString</span><span class="p">(</span><span class="n">sha1</span><span class="p">.</span><span class="na">digest</span><span class="p">()));</span>
            <span class="n">md5</span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">cert</span><span class="p">.</span><span class="na">getEncoded</span><span class="p">());</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;   md5     &quot;</span> <span class="o">+</span> <span class="n">toHexString</span><span class="p">(</span><span class="n">md5</span><span class="p">.</span><span class="na">digest</span><span class="p">()));</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Enter certificate to add to trusted keystore or &#39;q&#39; to quit: [1]&quot;</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="p">.</span><span class="na">readLine</span><span class="p">().</span><span class="na">trim</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;KeyStore not changed&quot;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">X509Certificate</span> <span class="n">cert</span> <span class="o">=</span> <span class="n">chain</span><span class="o">[</span><span class="n">k</span><span class="o">]</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">alias</span> <span class="o">=</span> <span class="n">host</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">ks</span><span class="p">.</span><span class="na">setCertificateEntry</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">cert</span><span class="p">);</span>

        <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="p">(</span><span class="s">&quot;cacerts&quot;</span><span class="p">);</span>
        <span class="n">ks</span><span class="p">.</span><span class="na">store</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">passphrase</span><span class="p">);</span>
        <span class="n">out</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>

        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">cert</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span>
                <span class="p">(</span><span class="s">&quot;Added certificate to keystore &#39;cacerts&#39; using alias &#39;&quot;</span>
                        <span class="o">+</span> <span class="n">alias</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">char</span><span class="o">[]</span> <span class="n">HEXDIGITS</span> <span class="o">=</span> <span class="s">&quot;0123456789abcdef&quot;</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">();</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toHexString</span><span class="p">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="p">(</span><span class="n">bytes</span><span class="p">.</span><span class="na">length</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">b</span> <span class="p">:</span> <span class="n">bytes</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">b</span> <span class="o">&amp;=</span> <span class="mh">0xff</span><span class="p">;</span>
            <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">HEXDIGITS</span><span class="o">[</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="o">]</span><span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="n">HEXDIGITS</span><span class="o">[</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mi">15</span><span class="o">]</span><span class="p">);</span>
            <span class="n">sb</span><span class="p">.</span><span class="na">append</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">sb</span><span class="p">.</span><span class="na">toString</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SavingTrustManager</span> <span class="kd">implements</span> <span class="n">X509TrustManager</span> <span class="p">{</span>

        <span class="kd">private</span> <span class="kd">final</span> <span class="n">X509TrustManager</span> <span class="n">tm</span><span class="p">;</span>
        <span class="kd">private</span> <span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="p">;</span>

        <span class="n">SavingTrustManager</span><span class="p">(</span><span class="n">X509TrustManager</span> <span class="n">tm</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">tm</span> <span class="o">=</span> <span class="n">tm</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="n">X509Certificate</span><span class="o">[]</span> <span class="nf">getAcceptedIssuers</span><span class="p">()</span> <span class="p">{</span>

        <span class="cm">/**</span>
<span class="cm">         * This change has been done due to the following resolution advised for Java 1.7+</span>
<span class="cm">        http://infposs.blogspot.kr/2013/06/installcert-and-java-7.html</span>
<span class="cm">             **/</span>

        <span class="k">return</span> <span class="k">new</span> <span class="n">X509Certificate</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
            <span class="c1">//throw new UnsupportedOperationException();</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkClientTrusted</span><span class="p">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="p">,</span> <span class="n">String</span> <span class="n">authType</span><span class="p">)</span>
                <span class="kd">throws</span> <span class="n">CertificateException</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">checkServerTrusted</span><span class="p">(</span><span class="n">X509Certificate</span><span class="o">[]</span> <span class="n">chain</span><span class="p">,</span> <span class="n">String</span> <span class="n">authType</span><span class="p">)</span>
                <span class="kd">throws</span> <span class="n">CertificateException</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="na">chain</span> <span class="o">=</span> <span class="n">chain</span><span class="p">;</span>
            <span class="n">tm</span><span class="p">.</span><span class="na">checkServerTrusted</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">authType</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ javac InstallCert.java
$ java InstallCert xyp.gov.mn:443
---------------------------------------------------------------
Server sent <span class="m">3</span> certificate<span class="o">(</span>s<span class="o">)</span>:

<span class="m">1</span> Subject <span class="nv">CN</span><span class="o">=</span>xyp.gov.mn, <span class="nv">EMAILADDRESS</span><span class="o">=</span>info@datacenter.gov.mn, <span class="nv">O</span><span class="o">=</span>National Data Center, <span class="nv">OU</span><span class="o">=</span>National Data Center, <span class="nv">ST</span><span class="o">=</span>Tuv, <span class="nv">C</span><span class="o">=</span>MN, <span class="nv">L</span><span class="o">=</span>Ulaanbaatar
Issuer  <span class="nv">CN</span><span class="o">=</span>Mongolian National Issuing CA, <span class="nv">O</span><span class="o">=</span>ITPTA, OID.2.5.4.51<span class="o">=</span><span class="s2">&quot;P.O.B-785, ITPTA Building&quot;</span>, <span class="nv">STREET</span><span class="o">=</span><span class="s2">&quot;Chinggis Square -1, Chingeltei&quot;</span>, <span class="nv">L</span><span class="o">=</span>Ulaanbaatar, <span class="nv">C</span><span class="o">=</span>MN
sha1    1e <span class="m">02</span> <span class="m">12</span> 0d 1a 7f b0 3d <span class="m">79</span> <span class="m">11</span> 0d 3a 2a <span class="m">36</span> <span class="m">84</span> af 3e <span class="m">75</span> <span class="m">26</span> dd
md5     <span class="m">94</span> <span class="m">81</span> 3e <span class="m">68</span> a8 <span class="m">45</span> <span class="m">15</span> a0 cf fa 9d e4 <span class="nb">fc</span> a3 c8 3b

<span class="m">2</span> Subject <span class="nv">CN</span><span class="o">=</span>Mongolian National Root CA, <span class="nv">O</span><span class="o">=</span>ITPTA, <span class="nv">C</span><span class="o">=</span>MN
Issuer  <span class="nv">CN</span><span class="o">=</span>Mongolian National Root CA, <span class="nv">O</span><span class="o">=</span>ITPTA, <span class="nv">C</span><span class="o">=</span>MN
sha1    fe c5 <span class="m">53</span> 5b <span class="m">04</span> a9 <span class="m">09</span> 7b b0 fb d0 e0 <span class="m">31</span> <span class="m">37</span> <span class="m">67</span> f8 <span class="m">57</span> d3 b4 6b
md5     <span class="m">87</span> <span class="m">35</span> 1c cb f4 <span class="m">23</span> 1d 6f b6 <span class="m">26</span> fa c8 3b 3f c3 ac

<span class="m">3</span> Subject <span class="nv">CN</span><span class="o">=</span>Mongolian National Issuing CA, <span class="nv">O</span><span class="o">=</span>ITPTA, OID.2.5.4.51<span class="o">=</span><span class="s2">&quot;P.O.B-785, ITPTA Building&quot;</span>, <span class="nv">STREET</span><span class="o">=</span><span class="s2">&quot;Chinggis Square -1, Chingeltei&quot;</span>, <span class="nv">L</span><span class="o">=</span>Ulaanbaatar, <span class="nv">C</span><span class="o">=</span>MN
Issuer  <span class="nv">CN</span><span class="o">=</span>Mongolian National Root CA, <span class="nv">O</span><span class="o">=</span>ITPTA, <span class="nv">C</span><span class="o">=</span>MN
sha1    e6 a7 <span class="m">75</span> f9 2d 5e <span class="m">32</span> dc <span class="m">95</span> 5f 3b 5c f7 <span class="m">44</span> df a0 fa 8b af <span class="m">66</span>
md5     f7 <span class="m">20</span> ef <span class="m">52</span> 0b ad e5 7c <span class="m">83</span> 9a <span class="m">59</span> <span class="m">65</span> 5a <span class="m">71</span> <span class="m">08</span> <span class="m">26</span>

Enter certificate to add to trusted keystore or <span class="s1">&#39;q&#39;</span> to quit: <span class="o">[</span><span class="m">1</span><span class="o">]</span>  <span class="c1"># Enter дар.</span>
.........................................................
.........................................................
Added certificate to keystore <span class="s1">&#39;cacerts&#39;</span> using <span class="nb">alias</span> <span class="s1">&#39;xyp.gov.mn-1&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">Үүссэн cacerts файлыг $JAVA_HOME/jre/lib/security хавтсанд хуулах. Хуулахаас өмнө cacerts файлыг нөөцлөж авна уу.</div>
</div>
<div class="line-block">
<div class="line">3.3 “wsimport” түүлээр package үүсгэх</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wsimport -d ./ https://xyp.gov.mn/citizen-1.2.1/ws?WSDL
</pre></div>
</div>
<div class="line-block">
<div class="line">Үүссэн “package”-ыг өөрийн прожектод импортлож оруулна.</div>
</div>
<div class="line-block">
<div class="line">3.4 Тоон гарын үсэг зурах модуль “XypSign.java”</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Base64</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Hashtable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.text.DateFormat</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.InvalidKeyException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.KeyStore</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.KeyStoreException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.PrivateKey</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.Signature</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.SignatureException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.UnrecoverableKeyException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.cert.CertificateException</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XypSign</span> <span class="p">{</span>

<span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">instance</span> <span class="o">=</span> <span class="s">&quot;JKS&quot;</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">aliasname</span><span class="p">;</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">KeyPath</span><span class="p">;</span>

<span class="kd">public</span> <span class="nf">XypSign</span><span class="p">(</span><span class="n">String</span> <span class="n">KeyPath</span><span class="p">,</span> <span class="n">String</span> <span class="n">aliasname</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="na">KeyPath</span> <span class="o">=</span> <span class="n">KeyPath</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">aliasname</span> <span class="o">=</span> <span class="n">aliasname</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="n">String</span> <span class="nf">GetCurrentTimestamp</span><span class="p">(){</span>
    <span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">();</span>
    <span class="n">DateFormat</span> <span class="n">dtf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleDateFormat</span><span class="p">(</span><span class="s">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Long</span><span class="p">.</span><span class="na">toString</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getTime</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">toBeSigned</span><span class="p">(</span><span class="n">String</span> <span class="n">accessToken</span><span class="p">){</span>
    <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">toBeSigned</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="n">toBeSigned</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;accessToken&quot;</span><span class="p">,</span> <span class="n">accessToken</span><span class="p">);</span>
    <span class="n">toBeSigned</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">GetCurrentTimestamp</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">toBeSigned</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">public</span> <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="nf">Sign</span><span class="p">(</span><span class="n">String</span> <span class="n">accessToken</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">KeyStoreException</span><span class="p">,</span> <span class="n">NoSuchAlgorithmException</span><span class="p">,</span> <span class="n">CertificateException</span><span class="p">,</span> <span class="n">FileNotFoundException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnrecoverableKeyException</span><span class="p">,</span> <span class="n">InvalidKeyException</span><span class="p">,</span> <span class="n">SignatureException</span><span class="p">{</span>

    <span class="n">String</span> <span class="n">signature</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="n">KeyStore</span> <span class="n">KS</span> <span class="o">=</span> <span class="n">KeyStore</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
    <span class="n">KS</span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="p">(</span><span class="n">KeyPath</span><span class="p">),</span> <span class="n">password</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">());</span>

    <span class="n">PrivateKey</span> <span class="n">pkey</span> <span class="o">=</span> <span class="p">(</span><span class="n">PrivateKey</span><span class="p">)</span><span class="n">KS</span><span class="p">.</span><span class="na">getKey</span><span class="p">(</span><span class="n">aliasname</span><span class="p">,</span> <span class="n">password</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">());</span>
    <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">toBeSigned</span> <span class="o">=</span> <span class="n">toBeSigned</span><span class="p">(</span><span class="n">accessToken</span><span class="p">);</span>

    <span class="n">Signature</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">Signature</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="s">&quot;SHA256withRSA&quot;</span><span class="p">);</span>
    <span class="n">ds</span><span class="p">.</span><span class="na">initSign</span><span class="p">(</span><span class="n">pkey</span><span class="p">);</span>
    <span class="n">ds</span><span class="p">.</span><span class="na">update</span><span class="p">(</span> <span class="p">(</span><span class="n">toBeSigned</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;accessToken&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="n">toBeSigned</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;timestamp&quot;</span><span class="p">)).</span><span class="na">getBytes</span><span class="p">());</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">Base64</span><span class="p">.</span><span class="na">getEncoder</span><span class="p">().</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">ds</span><span class="p">.</span><span class="na">sign</span><span class="p">());</span>

    <span class="n">toBeSigned</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;signature&quot;</span><span class="p">,</span> <span class="n">signature</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">toBeSigned</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">3.5 ХУР Төрийн Мэдээлэл Солилцооны системээс сервис дуудах жишээ код “XypClient.java”</div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">com.ndc.external.citizen.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.xml.ws.BindingProvider</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.xml.ws.handler.MessageContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.InvalidKeyException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchAlgorithmException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.NoSuchProviderException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.SignatureException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.security.cert.CertificateException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">XypClient</span> <span class="p">{</span>

<span class="kd">static</span> <span class="n">String</span> <span class="n">wsdl</span> <span class="o">=</span> <span class="s">&quot;https://xyp.gov.mn/citizen-1.2.1/ws?WSDL&quot;</span><span class="p">;</span>
<span class="kd">static</span> <span class="n">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="s">&quot;access_token&quot;</span><span class="p">;</span>
<span class="kd">static</span> <span class="n">String</span> <span class="n">aliasName</span> <span class="o">=</span> <span class="s">&quot;xyp&quot;</span><span class="p">;</span>
<span class="kd">static</span> <span class="n">String</span> <span class="n">keyPath</span> <span class="o">=</span> <span class="s">&quot;JKS_file.jks&quot;</span><span class="p">;</span>
<span class="kd">static</span> <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;JKS_PASSWORD&quot;</span><span class="p">;</span>
<span class="kd">static</span> <span class="n">String</span> <span class="n">regNum</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="kd">static</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">imageData</span><span class="p">;</span>                              <span class="c1">// 310x310 харьцаатай PNG өртгөлтэй</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">CitizenService</span> <span class="n">citizenService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CitizenServiceService</span><span class="p">().</span><span class="na">getCitizenServicePort</span><span class="p">();</span>

        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">req_ctx</span> <span class="o">=</span> <span class="p">((</span><span class="n">BindingProvider</span><span class="p">)</span><span class="n">citizenService</span><span class="p">).</span><span class="na">getRequestContext</span><span class="p">();</span>
        <span class="n">req_ctx</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">BindingProvider</span><span class="p">.</span><span class="na">ENDPOINT_ADDRESS_PROPERTY</span><span class="p">,</span> <span class="n">wsdl</span><span class="p">);</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="n">Hashtable</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">fields</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XypSign</span><span class="p">(</span><span class="n">keyPath</span><span class="p">,</span> <span class="n">aliasName</span><span class="p">,</span> <span class="n">password</span><span class="p">).</span><span class="na">Sign</span><span class="p">(</span><span class="n">accessToken</span><span class="p">);</span>

        <span class="k">try</span><span class="p">{</span>

            <span class="n">headers</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;accessToken&quot;</span><span class="p">,</span> <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;accessToken&quot;</span><span class="p">)));</span>
            <span class="n">headers</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;timestamp&quot;</span><span class="p">,</span> <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;timestamp&quot;</span><span class="p">)));</span>
            <span class="n">headers</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;signature&quot;</span><span class="p">,</span> <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;signature&quot;</span><span class="p">)));</span>
            <span class="n">req_ctx</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">MessageContext</span><span class="p">.</span><span class="na">HTTP_REQUEST_HEADERS</span><span class="p">,</span> <span class="n">headers</span><span class="p">);</span>

            <span class="n">CitizenRequestData</span> <span class="n">requestData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CitizenRequestData</span><span class="p">();</span>
            <span class="n">AuthorizationData</span> <span class="n">authorizationData</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthorizationData</span><span class="p">();</span>
            <span class="n">AuthorizationEntity</span> <span class="n">authorizationEntity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthorizationEntity</span><span class="p">();</span>

            <span class="n">authorizationEntity</span><span class="p">.</span><span class="na">setRegnum</span><span class="p">(</span><span class="n">regNum</span><span class="p">);</span>
            <span class="n">authorizationEntity</span><span class="p">.</span><span class="na">setFingerprint</span><span class="p">(</span><span class="n">imageData</span><span class="p">);</span>

            <span class="n">authorizationData</span><span class="p">.</span><span class="na">setCitizen</span><span class="p">(</span><span class="n">authorizationEntity</span><span class="p">);</span>

            <span class="n">requestData</span><span class="p">.</span><span class="na">setRegnum</span><span class="p">(</span><span class="n">regNum</span><span class="p">);</span>
            <span class="n">requestData</span><span class="p">.</span><span class="na">setAuth</span><span class="p">(</span><span class="n">authorizationData</span><span class="p">);</span>
            <span class="n">ServiceResponse</span> <span class="n">serviceResponse</span> <span class="o">=</span> <span class="n">citizenService</span><span class="p">.</span><span class="na">ws100101GetCitizenIDCardInfo</span><span class="p">(</span><span class="n">requestData</span><span class="p">);</span>

            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">serviceResponse</span><span class="p">.</span><span class="na">getResultCode</span><span class="p">());</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">serviceResponse</span><span class="p">.</span><span class="na">getResultMessage</span><span class="p">());</span>

        <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">){</span>
            <span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="faq.html" class="btn btn-neutral float-right" title="Бусад" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../docs/doc4.html" class="btn btn-neutral float-left" title="5. Вэб сервис дуудах" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021 он. Үндэсний Дата Төв УТҮГ. Бүх эрх хуулиар хамгаалагдсан.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>